var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function r(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),dragonBones;!function(e){var t=function(t){function r(){return t.call(this)||this}return __extends(r,t),r.toString=function(){return"[class dragonBones.EgretTextureAtlasData]"},r.prototype._onClear=function(){t.prototype._onClear.call(this),this.texture,this.texture=null},r.prototype.generateTexture=function(){return e.BaseObject.borrowObject(i)},r.prototype.dispose=function(){this.returnToPool()},r}(e.TextureAtlasData);e.EgretTextureAtlasData=t;var i=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.toString=function(){return"[class dragonBones.EgretTextureData]"},t.prototype._onClear=function(){e.prototype._onClear.call(this),this.texture,this.texture=null},t}(e.TextureData);e.EgretTextureData=i}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(e){function t(t,i,r,a){return e.call(this,t,i,r,a)||this}return __extends(t,e),Object.defineProperty(t.prototype,"eventObject",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationName",{get:function(){return this.eventObject.animationState.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"armature",{get:function(){return this.eventObject.armature},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bone",{get:function(){return this.eventObject.bone},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"slot",{get:function(){return this.eventObject.slot},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animationState",{get:function(){return this.eventObject.animationState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameLabel",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"sound",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"movementID",{get:function(){return this.animationName},enumerable:!0,configurable:!0}),t}(egret.Event);t.START=e.EventObject.START,t.LOOP_COMPLETE=e.EventObject.LOOP_COMPLETE,t.COMPLETE=e.EventObject.COMPLETE,t.FADE_IN=e.EventObject.FADE_IN,t.FADE_IN_COMPLETE=e.EventObject.FADE_IN_COMPLETE,t.FADE_OUT=e.EventObject.FADE_OUT,t.FADE_OUT_COMPLETE=e.EventObject.FADE_OUT_COMPLETE,t.FRAME_EVENT=e.EventObject.FRAME_EVENT,t.SOUND_EVENT=e.EventObject.SOUND_EVENT,t.ANIMATION_FRAME_EVENT=e.EventObject.FRAME_EVENT,t.BONE_FRAME_EVENT=e.EventObject.FRAME_EVENT,t.MOVEMENT_FRAME_EVENT=e.EventObject.FRAME_EVENT,t.SOUND=e.EventObject.SOUND_EVENT,e.EgretEvent=t;var i=function(i){function r(){return i.call(this)||this}return __extends(r,i),r.prototype._onClear=function(){this._disposeProxy=!1,this._armature=null,this._debugDrawer=null},r.prototype._dispatchEvent=function(e,r){var a=egret.Event.create(t,e);a.data=r,i.prototype.dispatchEvent.call(this,a),egret.Event.release(a)},r.prototype._debugDraw=function(e){if(e){this._debugDrawer||(this._debugDrawer=new egret.Sprite),this.addChild(this._debugDrawer),this._debugDrawer.graphics.clear();for(var t=this._armature.getBones(),i=0,r=t.length;i<r;++i){var a=t[i],n=a.boneData.length,o=a.globalTransformMatrix.tx,s=a.globalTransformMatrix.ty,l=o+a.globalTransformMatrix.a*n,c=s+a.globalTransformMatrix.b*n;this._debugDrawer.graphics.lineStyle(2,a.ik?16711680:65535,.7),this._debugDrawer.graphics.moveTo(o,s),this._debugDrawer.graphics.lineTo(l,c),this._debugDrawer.graphics.lineStyle(0,0,0),this._debugDrawer.graphics.beginFill(65535,.7),this._debugDrawer.graphics.drawCircle(o,s,3),this._debugDrawer.graphics.endFill()}for(var h=this._armature.getSlots(),i=0,r=h.length;i<r;++i){var u=h[i],p=u.boundingBoxData;if(p){var d=this._debugDrawer.getChildByName(u.name);switch(d||(d=new egret.Shape,d.name=u.name,this._debugDrawer.addChild(d)),d.graphics.clear(),d.graphics.beginFill(p.color?p.color:16711935,.3),p.type){case 0:d.graphics.drawRect(.5*-p.width,.5*-p.height,p.width,p.height);break;case 1:d.graphics.drawEllipse(.5*-p.width,.5*-p.height,p.width,p.height);break;case 2:for(var f=p.vertices,_=0,g=p.vertices.length;_<g;_+=2)0===_?d.graphics.moveTo(f[_],f[_+1]):d.graphics.lineTo(f[_],f[_+1])}d.graphics.endFill(),u._updateTransformAndMatrix(),u.updateGlobalTransform(),d.$setMatrix(u.globalTransformMatrix,!1)}else{var d=this._debugDrawer.getChildByName(u.name);d&&this._debugDrawer.removeChild(d)}}}else this._debugDrawer&&this._debugDrawer.parent===this&&this.removeChild(this._debugDrawer)},r.prototype.dispose=function(e){void 0===e&&(e=!0),this._disposeProxy=e,this._armature&&(this._armature.dispose(),this._armature=null)},r.prototype.hasEvent=function(e){return this.hasEventListener(e)},r.prototype.addEvent=function(e,t,i){this.addEventListener(e,t,i)},r.prototype.removeEvent=function(e,t,i){this.removeEventListener(e,t,i)},Object.defineProperty(r.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),r.prototype.advanceTimeBySelf=function(t){t?this._armature.clock=e.EgretFactory.clock:this._armature.clock=null},r}(egret.DisplayObjectContainer);e.EgretArmatureDisplay=i;var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(t);e.Event=r;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(t);e.ArmatureEvent=a;var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(t);e.AnimationEvent=n;var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(t);e.FrameEvent=o;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(t);e.SoundEvent=s;var l=function(t){function i(i,r,a){void 0===a&&(a=1);var n=t.call(this)||this;return n._onClear(),n.texture=i,e.ObjectDataParser.getInstance().parseTextureAtlasData(r,n,a),n}return __extends(i,t),i.toString=function(){return"[class dragonBones.EgretTextureAtlas]"},i}(e.EgretTextureAtlasData);e.EgretTextureAtlas=l;var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(l);e.EgretSheetAtlas=c;var h=function(){function t(){}return t.getInstance=function(){return e.EgretFactory.factory.soundEventManager},t}();e.SoundEventManager=h;var u=function(){function e(){}return e}();e.AnimationCacheManager=u}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.toString=function(){return"[class dragonBones.EgretSlot]"},i.prototype._onClear=function(){t.prototype._onClear.call(this),this.transformUpdateEnabled=!1,this._renderDisplay=null,this._colorFilter=null},i.prototype._initDisplay=function(e){},i.prototype._disposeDisplay=function(e){},i.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display?this._display:this._rawDisplay},i.prototype._addDisplay=function(){var e=this._armature.display;e.addChild(this._renderDisplay)},i.prototype._replaceDisplay=function(e){var t=this._armature.display,i=e;t.addChild(this._renderDisplay),t.swapChildren(this._renderDisplay,i),t.removeChild(i)},i.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)},i.prototype._updateZOrder=function(){var e=this._armature.display,t=e.getChildIndex(this._renderDisplay);t!==this._zOrder&&e.addChildAt(this._renderDisplay,this._zOrder)},i.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible},i.prototype._updateBlendMode=function(){switch(this._blendMode){case 0:this._renderDisplay.blendMode=egret.BlendMode.NORMAL;break;case 1:this._renderDisplay.blendMode=egret.BlendMode.ADD;break;case 5:this._renderDisplay.blendMode=egret.BlendMode.ERASE}},i.prototype._updateColor=function(){if(1!==this._colorTransform.redMultiplier||1!==this._colorTransform.greenMultiplier||1!==this._colorTransform.blueMultiplier||0!==this._colorTransform.redOffset||0!==this._colorTransform.greenOffset||0!==this._colorTransform.blueOffset||0!==this._colorTransform.alphaOffset){this._colorFilter||(this._colorFilter=new egret.ColorMatrixFilter);var e=this._colorFilter.matrix;e[0]=this._colorTransform.redMultiplier,e[6]=this._colorTransform.greenMultiplier,e[12]=this._colorTransform.blueMultiplier,e[18]=this._colorTransform.alphaMultiplier,e[4]=this._colorTransform.redOffset,e[9]=this._colorTransform.greenOffset,e[14]=this._colorTransform.blueOffset,e[19]=this._colorTransform.alphaOffset,this._colorFilter.matrix=e;var t=this._renderDisplay.filters;t||(t=[]),t.indexOf(this._colorFilter)<0&&t.push(this._colorFilter),this._renderDisplay.filters=t,this._renderDisplay.$setAlpha(1)}else this._colorFilter&&(this._colorFilter=null,this._renderDisplay.filters=null),this._renderDisplay.$setAlpha(this._colorTransform.alphaMultiplier)},i.prototype._updateFrame=function(){var t=this._meshData&&this._display===this._meshDisplay,i=this._textureData;if(this._displayIndex>=0&&this._display&&i){var r=i.parent;this._armature.replacedTexture&&this._displayData&&r===this._displayData.texture.parent&&(r=this._armature._replaceTextureAtlasData,r||(r=e.BaseObject.borrowObject(e.EgretTextureAtlasData),r.copyFrom(this._textureData.parent),r.texture=this._armature.replacedTexture,this._armature._replaceTextureAtlasData=r),i=r.getTexture(i.name));var a=r.texture?r.texture._bitmapData:null;if(a){if(!i.texture){var n=r.width>0?r.width:a.width,o=r.height>0?r.height:a.height,s=Math.min(i.region.width,n-i.region.x),l=Math.min(i.region.height,o-i.region.y);i.texture=new egret.Texture,i.texture._bitmapData=a,i.texture.$initData(i.region.x,i.region.y,s,l,0,0,s,l,n,o)}if(t){var c=this._renderDisplay,h=c.$renderNode;h.uvs.length=0,h.vertices.length=0,h.indices.length=0;for(var u=0,p=this._meshData.vertices.length;u<p;++u)h.uvs[u]=this._meshData.uvs[u],h.vertices[u]=this._meshData.vertices[u];for(var u=0,p=this._meshData.vertexIndices.length;u<p;++u)h.indices[u]=this._meshData.vertexIndices[u];c.$setBitmapData(i.texture),c.$setAnchorOffsetX(this._pivotX),c.$setAnchorOffsetY(this._pivotY),c.$updateVertices(),c.$invalidateTransform()}else{var d=this._renderDisplay;d.$setBitmapData(i.texture),d.$setAnchorOffsetX(this._pivotX),d.$setAnchorOffsetY(this._pivotY)}return void this._updateVisible()}}if(t){var c=this._renderDisplay;c.$setBitmapData(null),c.x=0,c.y=0,c.visible=!1}else{var d=this._renderDisplay;d.$setBitmapData(null),d.x=0,d.y=0,d.visible=!1}},i.prototype._updateMesh=function(){var e=this._renderDisplay,t=e.$renderNode,i=this._ffdVertices.length>0;if(this._meshData.skinned){for(var r=0,a=0,n=this._meshData.vertices.length;r<n;r+=2){for(var o=r/2,s=this._meshData.boneIndices[o],l=this._meshData.boneVertices[o],c=this._meshData.weights[o],h=0,u=0,p=0,d=s.length;p<d;++p){var f=this._meshBones[s[p]],_=f.globalTransformMatrix,g=c[p],m=0,y=0;i?(m=l[2*p]+this._ffdVertices[a],y=l[2*p+1]+this._ffdVertices[a+1]):(m=l[2*p],y=l[2*p+1]),h+=(_.a*m+_.c*y+_.tx)*g,u+=(_.b*m+_.d*y+_.ty)*g,a+=2}t.vertices[r]=h,t.vertices[r+1]=u}e.$updateVertices(),e.$invalidateTransform()}else if(i){for(var v=this._meshData.vertices,r=0,n=this._meshData.vertices.length;r<n;r+=2){var h=v[r]+this._ffdVertices[r],u=v[r+1]+this._ffdVertices[r+1];t.vertices[r]=h,t.vertices[r+1]=u}e.$updateVertices(),e.$invalidateTransform()}},i.prototype._updateTransform=function(e){if(e){var t=this._renderDisplay.matrix;t.identity(),this._renderDisplay.$setMatrix(t,this.transformUpdateEnabled)}else if(this.transformUpdateEnabled)this._renderDisplay.$setMatrix(this.globalTransformMatrix,!0);else{var i=this._renderDisplay.$DisplayObject,r=i[6];r.a=this.globalTransformMatrix.a,r.b=this.globalTransformMatrix.b,r.c=this.globalTransformMatrix.c,r.d=this.globalTransformMatrix.d,r.tx=this.globalTransformMatrix.tx,r.ty=this.globalTransformMatrix.ty,this._renderDisplay.$removeFlags(8),this._renderDisplay.$invalidatePosition()}},i}(e.Slot);e.EgretSlot=t}(dragonBones||(dragonBones={}));var dragonBones;!function(e){var t=function(t){function i(r){void 0===r&&(r=null);var a=t.call(this,r)||this;return i._eventManager||(i._eventManager=new e.EgretArmatureDisplay,i._clock=new e.WorldClock,i._clock.time=.001*egret.getTimer(),egret.startTick(i._clockHandler,i)),a}return __extends(i,t),i._clockHandler=function(e){e*=.001;var t=e-i._clock.time;return i._clock.advanceTime(t),i._clock.time=e,!1},Object.defineProperty(i,"factory",{get:function(){return i._factory||(i._factory=new i),i._factory},enumerable:!0,configurable:!0}),Object.defineProperty(i,"clock",{get:function(){return i._clock},enumerable:!0,configurable:!0}),i.prototype._generateTextureAtlasData=function(t,i){return t?t.texture=i:t=e.BaseObject.borrowObject(e.EgretTextureAtlasData),t},i.prototype._generateArmature=function(t){var r=e.BaseObject.borrowObject(e.Armature),a=new e.EgretArmatureDisplay;return a._armature=r,r._init(t.armature,t.skin,a,a,i._eventManager),r},i.prototype._generateSlot=function(t,i,r){var a=i.slot,n=e.BaseObject.borrowObject(e.EgretSlot),o=[];n._init(i,new egret.Bitmap,new egret.Mesh);for(var s=0,l=i.displays.length;s<l;++s){var c=i.displays[s];switch(c.type){case 0:c.texture||(c.texture=this._getTextureData(t.dataName,c.path)),t.textureAtlasName&&(n._textureDatas[s]=this._getTextureData(t.textureAtlasName,c.path)),o[s]=n.rawDisplay;break;case 2:c.texture||(c.texture=this._getTextureData(t.dataName,c.path)),t.textureAtlasName&&(n._textureDatas[s]=this._getTextureData(t.textureAtlasName,c.path)),!c.mesh&&c.share&&(c.mesh=i.getMesh(c.share)),"webgl"===egret.Capabilities.renderMode||egret.Capabilities.runtimeType===egret.RuntimeType.NATIVE?o[s]=n.meshDisplay:(console.warn("Canvas can not support mesh, please change renderMode to webgl."),o[s]=n.rawDisplay);break;case 1:var h=this.buildArmature(c.path,t.dataName,null,t.textureAtlasName);if(h){if(h.inheritAnimation=c.inheritAnimation,!h.inheritAnimation){var u=a.actions.length>0?a.actions:h.armatureData.actions;if(u.length>0)for(var p=0,d=u.length;p<d;++p)h._bufferAction(u[p]);else h.animation.play()}c.armature=h.armatureData}o[s]=h;break;default:o[s]=null}}return n._setDisplayList(o),n},i.prototype.buildArmatureDisplay=function(e,t,r,a){void 0===t&&(t=null),void 0===r&&(r=null),void 0===a&&(a=null);var n=this.buildArmature(e,t,r,a);return n?(i._clock.add(n),n.display):null},i.prototype.getTextureDisplay=function(e,t){void 0===t&&(t=null);var i=this._getTextureData(t,e);if(i){if(!i.texture){var r=i.parent.texture;i.texture=new egret.Texture,i.texture._bitmapData=r._bitmapData,i.texture.$initData(i.region.x,i.region.y,i.region.width,i.region.height,0,0,i.region.width,i.region.height,r.textureWidth,r.textureHeight)}return new egret.Bitmap(i.texture)}return null},Object.defineProperty(i.prototype,"soundEventManager",{get:function(){return i._eventManager},enumerable:!0,configurable:!0}),i.prototype.addSkeletonData=function(e,t){void 0===t&&(t=null),this.addDragonBonesData(e,t)},i.prototype.getSkeletonData=function(e){return this.getDragonBonesData(e)},i.prototype.removeSkeletonData=function(e){this.removeDragonBonesData(e)},i.prototype.addTextureAtlas=function(e,t){void 0===t&&(t=null),this.addTextureAtlasData(e,t)},i.prototype.getTextureAtlas=function(e){return this.getTextureAtlasData(e)},i.prototype.removeTextureAtlas=function(e){this.removeTextureAtlasData(e)},i.prototype.buildFastArmature=function(e,t,i){return void 0===t&&(t=null),void 0===i&&(i=null),this.buildArmature(e,t,i)},i.prototype.dispose=function(){this.clear()},Object.defineProperty(i.prototype,"soundEventManater",{get:function(){return i._eventManager},enumerable:!0,configurable:!0}),i}(e.BaseFactory);t._factory=null,t._eventManager=null,t._clock=null,e.EgretFactory=t}(dragonBones||(dragonBones={}));var dragonBones;!function(e){function t(e,t){for(var i=0,r=e.length;i<r;++i){var a=e[i];if(a.name===t)return a}return null}function i(e){if(e.groupName){var i=p[e.groupName];if(i){var r=t(i.movie,e.movieName);if(r)return e.groupConfig=i,e.movieConfig=r,!0}}if(!e.groupName)for(var a in p){var i=p[a];if(!e.groupName){var r=t(i.movie,e.movieName);if(r)return e.groupName=a,e.groupConfig=i,e.movieConfig=r,!0}}return!1}function r(e){return null!=p[e]}function a(e,t,i){if(void 0===i&&(i=null),!e)throw new Error;var r=new egret.ByteArray(e);r.endian=egret.Endian.LITTLE_ENDIAN,r.position=8;var a=JSON.parse(r.readUTF());a.offset=r.position,a.arrayBuffer=e,a.textures=[];var n=a.offset%4;n&&(a.offset+=4-n);for(var o=0,s=a.position.length;o<s;o+=3)switch(o/3){case 1:a.displayFrameArray=new Int16Array(a.arrayBuffer,a.offset+a.position[o],a.position[o+1]/a.position[o+2]);break;case 2:a.rectangleArray=new Float32Array(a.arrayBuffer,a.offset+a.position[o],a.position[o+1]/a.position[o+2]);break;case 3:a.transformArray=new Float32Array(a.arrayBuffer,a.offset+a.position[o],a.position[o+1]/a.position[o+2]);break;case 4:a.colorArray=new Int16Array(a.arrayBuffer,a.offset+a.position[o],a.position[o+1]/a.position[o+2])}if(i=i||a.name,p[i],p[i]=a,t instanceof Array)for(var o=0,s=t.length;o<s;++o){var l=t[o];a.textures.push(l)}else a.textures.push(t)}function n(e){var t=p[e];t&&delete p[e]}function o(){for(var e in p)delete p[e]}function s(e,t){void 0===t&&(t=null);var r={movieName:e,groupName:t};if(i(r)){var a=new f(r);return a}return console.warn("No movie named: "+e),null}function l(e){var t=p[e];if(t){for(var i=[],r=0,a=t.movie.length;r<a;++r)i.push(t.movie[r].name);return i}return console.warn("No group named: "+e),null}var c=function(e){function t(t){var i=e.call(this)||this;return i.displayIndex=-1,i.colorIndex=-1,i.transformIndex=-1,i.rawDisplay=new egret.Bitmap,i.childMovies={},i.config=null,i.displayConfig=null,i.display=null,i.childMovie=null,i.colorFilter=null,i.display=i.rawDisplay,i.config=t,i.rawDisplay.name=i.config.name,null==i.config.blendMode&&(i.config.blendMode=0),i}return __extends(t,e),t.prototype.dispose=function(){this.rawDisplay=null,this.childMovies=null,this.config=null,this.displayConfig=null,this.display=null,this.childMovie=null,this.colorFilter=null},t}(egret.HashObject),h=new egret.Rectangle,u=new egret.Matrix,p={};e.hasMovieGroup=r,e.addMovieGroup=a,e.removeMovieGroup=n,e.removeAllMovieGroup=o,e.buildMovie=s,e.getMovieNames=l;var d=function(e){function t(t){var i=e.call(this,t)||this;return i.name=null,i.slotName=null,i.clipName=null,i.movie=null,i}return __extends(t,e),t}(egret.Event);d.START="start",d.LOOP_COMPLETE="loopComplete",d.COMPLETE="complete",d.FRAME_EVENT="frameEvent",d.SOUND_EVENT="soundEvent",e.MovieEvent=d;var f=function(t){function i(r){var a=t.call(this)||this;a.timeScale=1,a.clipTimeScale=1,a._batchEnabled=!0,a._isLockDispose=!1,a._isDelayDispose=!1,a._isStarted=!1,a._isPlaying=!1,a._isReversing=!1,a._isCompleted=!1,a._playTimes=0,a._time=0,a._currentTime=0,a._timeStamp=0,a._currentPlayTimes=0,a._cacheFrameIndex=0,a._frameSize=0,a._cacheRectangle=null,a._clock=null,a._groupConfig=null,a._config=null,a._clipConfig=null,a._currentFrameConfig=null,a._clipArray=null,a._clipNames=[],a._slots=[],a._childMovies=[],a._groupConfig=r.groupConfig,a._config=r.movieConfig,a._batchEnabled=!a._config.isNested,a._batchEnabled&&(a.$renderNode=new egret.sys.GroupNode,a.$renderNode.cleanBeforeRender=i._cleanBeforeRender),a._clipNames.length=0;for(var n=0,o=a._config.clip.length;n<o;++n)a._clipNames.push(a._config.clip[n].name);for(var n=0,o=a._config.slot.length;n<o;++n){var s=new c(a._config.slot[n]);a._updateSlotBlendMode(s),a._slots.push(s),a._batchEnabled?a.$renderNode.addNode(s.rawDisplay.$renderNode):a.addChild(s.rawDisplay)}return a._frameSize=2*a._slots.length,e.EgretFactory.factory,a.advanceTimeBySelf(!0),a.name=a._config.name,a.play(),a.advanceTime(1e-6),a.stop(),a}return __extends(i,t),i._cleanBeforeRender=function(){},i.prototype._configToEvent=function(e,t){t.movie=this,t.clipName=this._clipConfig.name,t.name=e.name,t.slotName=e.slot},i.prototype._onCrossFrame=function(t){for(var i=0,r=t.actionAndEvent.length;i<r;++i){var a=t.actionAndEvent[i];if(a)switch(a.type){case 11:if(e.EgretFactory.factory.soundEventManager.hasEventListener(d.SOUND_EVENT)){var n=egret.Event.create(d,d.SOUND_EVENT);this._configToEvent(a,n),e.EgretFactory.factory.soundEventManager.dispatchEvent(n),egret.Event.release(n)}break;case 10:if(this.hasEventListener(d.FRAME_EVENT)){var o=egret.Event.create(d,d.FRAME_EVENT);this._configToEvent(a,o),this.dispatchEvent(o),egret.Event.release(o)}break;case 0:case 4:if(a.slot){var s=this._getSlot(a.slot);s&&s.childMovie&&s.childMovie.play(a.name)}else this.play(a.name)}}},i.prototype._updateSlotBlendMode=function(e){var t="";switch(e.config.blendMode){case 0:t=egret.BlendMode.NORMAL;break;case 1:t=egret.BlendMode.ADD;break;case 5:t=egret.BlendMode.ERASE}t&&(this._batchEnabled?e.display.$renderNode.blendMode=egret.sys.blendModeToNumber(t):e.display.blendMode=t)},i.prototype._updateSlotColor=function(e,t,i,r,a,n,o,s,l){if(1!==i||1!==r||1!==a||0!==o||0!==s||0!==l||0!==n){e.colorFilter||(e.colorFilter=new egret.ColorMatrixFilter);var c=e.colorFilter.matrix;if(c[0]=i,c[6]=r,c[12]=a,c[18]=t,c[4]=o,c[9]=s,c[14]=l,c[19]=n,e.colorFilter.matrix=c,this._batchEnabled){e.display.$renderNode.filter;e.display.$renderNode.filter=e.colorFilter,e.display.$renderNode.alpha=1}else{var h=e.display.filters;h||(h=[]),h.indexOf(e.colorFilter)<0&&h.push(e.colorFilter),e.display.filters=h,e.display.$setAlpha(1)}}else e.colorFilter&&(e.colorFilter=null),this._batchEnabled?(e.display.$renderNode.filter=null,e.display.$renderNode.alpha=t):(e.display.filters=null,e.display.$setAlpha(t))},i.prototype._updateSlotDisplay=function(e){var t=e.display||e.rawDisplay,i=e.childMovie;if(e.displayIndex>=0)if(e.displayConfig=this._groupConfig.display[e.displayIndex],1===e.displayConfig.type){var r=e.childMovies[e.displayConfig.name];r||(r=s(e.displayConfig.name,this._groupConfig.name),r.advanceTimeBySelf(!1),e.childMovies[e.displayConfig.name]=r),e.display=r,e.childMovie=r}else e.display=e.rawDisplay,e.childMovie=null;else e.displayConfig=null,e.display=e.rawDisplay,e.childMovie=null;if(e.display!==t&&(t&&(this.addChild(e.display),this.swapChildren(e.display,t),this.removeChild(t)),this._updateSlotBlendMode(e)),e.display===e.rawDisplay)if(e.displayConfig&&null!=e.displayConfig.regionIndex){if(!e.displayConfig.texture){var a=this._groupConfig.textures[e.displayConfig.textureIndex||0],n=4*e.displayConfig.regionIndex,o=this._groupConfig.rectangleArray[n],l=this._groupConfig.rectangleArray[n+1],c=this._groupConfig.rectangleArray[n+2],h=this._groupConfig.rectangleArray[n+3];e.displayConfig.texture=new egret.Texture,e.displayConfig.texture._bitmapData=a._bitmapData,e.displayConfig.texture.$initData(o,l,Math.min(c,a.textureWidth-o),Math.min(h,a.textureHeight-l),0,0,Math.min(c,a.textureWidth-o),Math.min(h,a.textureHeight-l),a.textureWidth,a.textureHeight)}if(this._batchEnabled){var u=e.displayConfig.texture,p=e.rawDisplay.$renderNode;egret.sys.RenderNode.prototype.cleanBeforeRender.call(e.rawDisplay.$renderNode),p.image=u._bitmapData,p.drawImage(u._bitmapX,u._bitmapY,u._bitmapWidth,u._bitmapHeight,u._offsetX,u._offsetY,u.textureWidth,u.textureHeight),p.imageWidth=u._sourceWidth,p.imageHeight=u._sourceHeight}else e.rawDisplay.visible=!0,e.rawDisplay.$setBitmapData(e.displayConfig.texture)}else this._batchEnabled?e.rawDisplay.$renderNode.image=null:(e.rawDisplay.visible=!1,e.rawDisplay.$setBitmapData(null));e.childMovie!==i&&(i&&(i.stop(),this._childMovies.slice(this._childMovies.indexOf(i),1)),e.childMovie&&(this._childMovies.indexOf(e.childMovie)<0&&this._childMovies.push(e.childMovie),e.config.action?e.childMovie.play(e.config.action):e.childMovie.play(e.childMovie._config.action)))},i.prototype._getSlot=function(e){for(var t=0,i=this._slots.length;t<i;++t){var r=this._slots[t];if(r.config.name===e)return r}return null},i.prototype.$render=function(){this._batchEnabled||t.prototype.$render.call(this)},i.prototype.$measureContentBounds=function(e){this._batchEnabled&&this._cacheRectangle?e.setTo(this._cacheRectangle.x,this._cacheRectangle.y,this._cacheRectangle.width-this._cacheRectangle.x,this._cacheRectangle.height-this._cacheRectangle.y):t.prototype.$measureContentBounds.call(this,e)},i.prototype.$doAddChild=function(e,i,r){return this._batchEnabled?(console.warn("Can not add child."),null):t.prototype.$doAddChild.call(this,e,i,r)},i.prototype.$doRemoveChild=function(e,i){return this._batchEnabled?(console.warn("Can not remove child."),null):t.prototype.$doRemoveChild.call(this,e,i)},i.prototype.dispose=function(){if(this._isLockDispose)this._isDelayDispose=!0;else{if(this._clock&&this._clock.remove(this),this._slots)for(var e=0,t=this._slots.length;e<t;++e)this._slots[e].dispose();this._isPlaying=!1,this._cacheRectangle=null,this._clock=null,this._groupConfig=null,this._config=null,this._clipConfig=null,this._currentFrameConfig=null,this._clipArray=null,this._clipNames=null,this._slots=null,this._childMovies=null}},i.prototype.advanceTime=function(e){for(var t=0,i=this._childMovies.length;t<i;++t)this._childMovies[t].advanceTime(e);if(this._isPlaying){this._isLockDispose=!0,e<0&&(e=-e),e*=this.timeScale,this._time+=e*this.clipTimeScale;var r=this._clipConfig.duration,a=r*this._playTimes,n=this._time,o=this._currentPlayTimes;if(this._playTimes>0&&(n>=a||n<=-a)?(this._isCompleted=!0,o=this._playTimes,n=n<0?0:r):(this._isCompleted=!1,n<0?(o=Math.floor(-n/r),n=r- -n%r):(o=Math.floor(n/r),n%=r),this._playTimes>0&&o>this._playTimes&&(o=this._playTimes)),this._currentTime===n)return;var s=Math.floor(n*this._clipConfig.cacheTimeToFrameScale);if(this._cacheFrameIndex!==s){this._cacheFrameIndex=s;var l=this._groupConfig.displayFrameArray,c=this._groupConfig.transformArray,p=this._groupConfig.colorArray,f=!0,_=!1,g=!1,m=this._cacheRectangle;this._cacheRectangle=this._clipConfig.cacheRectangles[this._cacheFrameIndex],this._batchEnabled&&!this._cacheRectangle&&(g=!0,this._cacheRectangle=new egret.Rectangle,this._clipConfig.cacheRectangles[this._cacheFrameIndex]=this._cacheRectangle);for(var t=0,i=this._slots.length;t<i;++t){var y=this._slots[t],v=this._frameSize*this._cacheFrameIndex+2*t;v>=this._clipArray.length&&(v=this._frameSize*(this._cacheFrameIndex-1)+2*t);var b=2*this._clipArray[v];if(b>=0){var x=l[b],E=8*l[b+1],D=6*this._clipArray[v+1],T=!1;if(y.displayIndex!==x&&(y.displayIndex=x,T=!0,this._updateSlotDisplay(y)),(y.colorIndex!==E||T)&&(y.colorIndex=E,y.colorIndex>=0?this._updateSlotColor(y,.01*p[E],.01*p[E+1],.01*p[E+2],.01*p[E+3],p[E+4],p[E+5],p[E+6],p[E+7]):this._updateSlotColor(y,1,1,1,1,0,0,0,0)),_=!0,y.transformIndex!==D)if(y.transformIndex=D,this._batchEnabled){var C=y.display.$renderNode.matrix;C||(C=y.display.$renderNode.matrix=new egret.Matrix),C.a=c[D],C.b=c[D+1],C.c=c[D+2],C.d=c[D+3],C.tx=c[D+4],C.ty=c[D+5]}else u.a=c[D],u.b=c[D+1],u.c=c[D+2],u.d=c[D+3],u.tx=c[D+4],u.ty=c[D+5],y.display.$setMatrix(u);if(this._batchEnabled&&g){var C=y.display.$renderNode.matrix;h.x=0,h.y=0,h.width=y.displayConfig.texture.textureWidth,h.height=y.displayConfig.texture.textureHeight,C.$transformBounds(h),f?(f=!1,this._cacheRectangle.x=h.x,this._cacheRectangle.width=h.x+h.width,this._cacheRectangle.y=h.y,this._cacheRectangle.height=h.y+h.height):(this._cacheRectangle.x=Math.min(this._cacheRectangle.x,h.x),this._cacheRectangle.width=Math.max(this._cacheRectangle.width,h.x+h.width),this._cacheRectangle.y=Math.min(this._cacheRectangle.y,h.y),this._cacheRectangle.height=Math.max(this._cacheRectangle.height,h.y+h.height))}}else y.displayIndex!==-1&&(y.displayIndex=-1,this._updateSlotDisplay(y))}this._cacheRectangle&&(_&&g&&f&&m&&(this._cacheRectangle.x=m.x,this._cacheRectangle.y=m.y,this._cacheRectangle.width=m.width,this._cacheRectangle.height=m.height),this.$invalidateContentBounds())}if(this._isCompleted&&(this._isPlaying=!1),!this._isStarted&&(this._isStarted=!0,this.hasEventListener(d.START))){var M=egret.Event.create(d,d.START);M.movie=this,M.clipName=this._clipConfig.name,M.name=null,M.slotName=null,this.dispatchEvent(M)}this._isReversing=this._currentTime>n&&this._currentPlayTimes===o,this._currentTime=n;var O=this._clipConfig.frame?this._clipConfig.frame.length:0;if(O>0){var w=Math.floor(this._currentTime*this._config.frameRate),A=this._groupConfig.frame[this._clipConfig.frame[w]];if(this._currentFrameConfig!==A)if(O>1){var N=this._currentFrameConfig;if(this._currentFrameConfig=A,!N){var F=Math.floor(this._currentTime*this._config.frameRate);N=this._groupConfig.frame[this._clipConfig.frame[F]],this._isReversing||(this._currentTime<=N.position||this._currentPlayTimes!==o)&&(N=this._groupConfig.frame[N.prev])}if(this._isReversing)for(;N!==A;)this._onCrossFrame(N),N=this._groupConfig.frame[N.prev];else for(;N!==A;)N=this._groupConfig.frame[N.next],this._onCrossFrame(N)}else this._currentFrameConfig=A,this._currentFrameConfig&&this._onCrossFrame(this._currentFrameConfig)}if(this._currentPlayTimes!==o){if(this._currentPlayTimes=o,this.hasEventListener(d.LOOP_COMPLETE)){var R=egret.Event.create(d,d.LOOP_COMPLETE);R.movie=this,R.clipName=this._clipConfig.name,R.name=null,R.slotName=null,this.dispatchEvent(R),egret.Event.release(R)}if(this._isCompleted&&this.hasEventListener(d.COMPLETE)){var B=egret.Event.create(d,d.COMPLETE);B.movie=this,B.clipName=this._clipConfig.name,B.name=null,B.slotName=null,this.dispatchEvent(B),egret.Event.release(B)}}}this._isLockDispose=!1,this._isDelayDispose&&this.dispose()},i.prototype.play=function(e,t){if(void 0===e&&(e=null),void 0===t&&(t=-1),e){for(var i=null,r=0,a=this._config.clip.length;r<a;++r){var n=this._config.clip[r];n.name===e&&(i=n)}i?(this._clipConfig=i,this._clipArray=new Int16Array(this._groupConfig.arrayBuffer,this._groupConfig.offset+this._groupConfig.position[0]+this._clipConfig.p,this._clipConfig.s/this._groupConfig.position[2]),this._clipConfig.cacheRectangles||(this._clipConfig.cacheRectangles=[]),this._isPlaying=!0,this._isStarted=!1,this._isCompleted=!1,t<0||t!==t?this._playTimes=this._clipConfig.playTimes:this._playTimes=t,this._time=0,this._currentTime=0,this._currentPlayTimes=0,this._cacheFrameIndex=-1,this._currentFrameConfig=null,this._cacheRectangle=null,this.clipTimeScale=1/this._clipConfig.scale):console.warn("No clip in movie.",this._config.name,e)}else this._clipConfig?this._isPlaying||this._isCompleted?this.play(this._clipConfig.name,this._playTimes):this._isPlaying=!0:this._config.action&&this.play(this._config.action,t)},i.prototype.stop=function(){this._isPlaying=!1},i.prototype.gotoAndPlay=function(e,t,i){void 0===e&&(e=null),void 0===i&&(i=-1),t%=this._clipConfig.duration,t<0&&(t+=this._clipConfig.duration),this.play(e,i),this._time=t,this._currentTime=t},i.prototype.gotoAndStop=function(e,t){void 0===e&&(e=null),t%=this._clipConfig.duration,t<0&&(t+=this._clipConfig.duration),this.play(e,1),this._time=t,this._currentTime=t,this.advanceTime(.001),this.stop()},i.prototype.hasClip=function(e){for(var t=0,i=this._config.clip.length;t<i;++t){var r=this._config.clip[t];if(r.name===e)return!0}return!1},Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this._isPlaying&&!this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isComplete",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentTime",{get:function(){return this._currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"totalTime",{get:function(){return this._clipConfig?this._clipConfig.duration:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentPlayTimes",{get:function(){
return this._currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playTimes",{get:function(){return this._playTimes},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"groupName",{get:function(){return this._groupConfig.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clipName",{get:function(){return this._clipConfig?this._clipConfig.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clipNames",{get:function(){return this._clipNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clock",{get:function(){return this._clock},set:function(e){if(this._clock!==e){var t=this._clock;this._clock=e,t&&t.remove(this),this._clock&&this._clock.add(this)}},enumerable:!0,configurable:!0}),i.prototype.advanceTimeBySelf=function(t){t?this.clock=e.EgretFactory.clock:this.clock=null},i}(egret.DisplayObjectContainer);e.Movie=f}(dragonBones||(dragonBones={}));